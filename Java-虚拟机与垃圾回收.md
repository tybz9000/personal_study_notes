# Java-虚拟机与垃圾回收

#### Java虚拟机

- Java有一套虚拟机规范，以及基于这套规范的一系列虚拟机实现
- HotSpot：使用范围最广的Java虚拟机
  - Sun JDK、OpenJDK都是用的它
- JRockit：被Oracle收购，很多优秀特性被移植到HotSpot
- IBM J9



![](D:\学习文件3\图片\java虚拟机.png)



#### Java内存空间

- 方法区（1.8之前的永久代，1.8元空间）
  - java规范定义的，永久代与元空间都是方法区的一种实现
  - 类常量、字符串常量、方法代码、类定义数据等
  - 回收永久代需要卸载类
  - 元空间：
    - 存储class matedata
      - Klass结构，Java类在虚拟机中的表示
        - 不同于Class对象，Class对象在堆中
      - method metadata，方法字节码，局部变量表，异常表，参数信息
      - 注解
      - 方法计数器
      - 元空间并不在虚拟机中存贮，直接存储在内存中
- 堆
- 栈
  - 每个线程有自己的虚拟机栈
  - 栈帧
    - 随着方法调用的层层深入，不断压入栈帧，一个方法一个栈帧
    - 局部变量表
    - 操作数栈
    - 动态链接：
      - 指向运行时常量池中该栈帧所属方法的引用
    - 返回地址
- 本地方法栈
- 程序计数器
  - 线程当前执行字节码的行号指示器
  - 不可能OutOfMemory
- 总结
  - 方法区与堆是线程共享的，其他的线程各自独占
